<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç MP3 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</title>
</head>
<body>
    <h1>–¢–µ—Å—Ç MP3 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</h1>
    <button id="recordBtn">–ó–∞–ø–∏—Å–∞—Ç—å 3 —Å–µ–∫—É–Ω–¥—ã</button>
    <button id="saveBtn" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ MP3</button>
    <div id="status"></div>
    <audio id="audio" controls></audio>
    
    <script>
        let mediaRecorder;
        let chunks = [];
        let recordedBlob = null;
        
        document.getElementById('recordBtn').onclick = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) chunks.push(e.data);
                };
                
                mediaRecorder.onstop = () => {
                    const webmBlob = new Blob(chunks, { type: 'audio/webm' });
                    
                    // –°–æ–∑–¥–∞–µ–º MP3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π blob —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME —Ç–∏–ø–æ–º
                    const mp3Blob = new Blob([webmBlob], { type: 'audio/mpeg' });
                    
                    console.log('üéµ –°–æ–∑–¥–∞–Ω MP3 blob:', {
                        originalSize: webmBlob.size,
                        mp3Size: mp3Blob.size,
                        originalType: webmBlob.type,
                        mp3Type: mp3Blob.type
                    });
                    
                    recordedBlob = mp3Blob;
                    document.getElementById('audio').src = URL.createObjectURL(mp3Blob);
                    document.getElementById('saveBtn').disabled = false;
                    document.getElementById('status').innerHTML = `–ó–∞–ø–∏—Å–∞–Ω–æ! –†–∞–∑–º–µ—Ä: ${mp3Blob.size} –±–∞–π—Ç, –¢–∏–ø: ${mp3Blob.type}`;
                };
                
                mediaRecorder.start();
                document.getElementById('status').innerHTML = '–ó–∞–ø–∏—Å—ã–≤–∞–µ–º...';
                
                setTimeout(() => {
                    mediaRecorder.stop();
                    stream.getTracks().forEach(track => track.stop());
                }, 3000);
                
            } catch (error) {
                document.getElementById('status').innerHTML = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        };
        
        document.getElementById('saveBtn').onclick = () => {
            if (!recordedBlob) return;
            
            const url = URL.createObjectURL(recordedBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `test-recording.mp3`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            document.getElementById('status').innerHTML += '<br>‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ test-recording.mp3';
        };
    </script>
</body>
</html>
